name: Update Protocol Documentation

on:
  push:
    paths:
      - 'protocol/**'
      - 'frontend/scripts/generate-protocol-docs.js'
  pull_request:
    paths:
      - 'protocol/**'
      - 'frontend/scripts/generate-protocol-docs.js'

jobs:
  update-docs:
    runs-on: ubuntu-latest
    name: Generate Protocol Documentation

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: 'frontend/package-lock.json'

      - name: Install frontend dependencies
        run: cd frontend && npm ci

      - name: Generate protocol documentation
        run: cd frontend && npm run build:protocol-docs

  notify-pr:
    runs-on: ubuntu-latest
    needs: update-docs
    if: github.event_name == 'pull_request' && needs.update-docs.result == 'success'
    steps:
      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const message = `## ðŸ“š Protocol Documentation

âœ… Protocol documentation has been generated and is ready for deployment.

**What happens next:**
- Documentation will be automatically generated during build
- Available at [Documentation page](https://refuse-protocol.org/docs) after merge
- All protocol changes are reflected in the generated docs`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });
